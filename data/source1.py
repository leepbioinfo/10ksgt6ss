# IPython log file

get_ipython().run_line_magic('ls', '')
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv")
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv", low_memory=False)
vndf.columns
vndf.query('nei_c in [1,6,11]').pfam.value_counts()
get_ipython().run_line_magic('page', '')
vndf.query('nei_c in [1,6,11]').pfam.value_counts().head(20)
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('less', 'model2function.yaml')
get_ipython().run_line_magic('ls', '..')
get_ipython().run_line_magic('ls', '../sources/')
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
get_ipython().run_line_magic('run', '../sources/working_dfs.py')
get_ipython().run_line_magic('ls', '')
dir()
get_ipython().run_line_magic('who', '')
final.head()
final['function'].value_counts()
get_ipython().run_line_magic('who', '')
df10.head()
len(df10)
len(vndf)
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
df10.t6.head()
df10.columns
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
df10.t6ss.head()
df10.t6ss.sum()
df10[df10.t6ss].query('nei_c in [1,6,11]').pfam.value_counts().head(20)
df10[df10.t6ss].query('nei_c in [1,6,11]').pfam.value_counts()
df10[df10.t6ss].pfam.value_counts()
df10[df10.t6ss].pfam.value_counts().head()
df10.query('nei_c in [1,6,11]').pfam.value_counts().head()
vndf.head()
vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts()
vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts().index.to_series().str.split("+").explode()
vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts().index.to_series().str.split("+").explode().unique()
", ".join(vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts().index.to_series().str.split("+").explode().unique())
vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts()
tc = vndf[vndf.t6ss].query('nei_c in [1,6,11]')
vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts().index.to_series().str.split("+").explode().drop_duplicates().to_list()
tf = vndf[vndf.t6ss].query('nei_c in [1,6,11]').pfam.value_counts().index.to_series().str.split("+").explode().drop_duplicates().to_list()
tc.pfam = tc.pfam.str.split("+")
tc.explode(),head()
tc.explode().head()
tc.explode('pfam').head()
tc = tc.explode('pfam')
tc.query('pfam not in @tf').pfam.value_counts()
tc.query('pfam not in @tf').head()
tc.head()
tc.pffam.head()
tc.pfam.head()
tf
get_ipython().run_line_magic('history', '')
tc = vndf[vndf.t6ss].query('nei_c in [1,6,11]')
tc.pfam = tc.pfam.str.split("+")
len(tc)
tc = tc.explode('pfam')
len(tc)
tf
tf = vndf[vndf.t6ss].query('nei_c not in [1,6,11]').pfam.value_counts().index.to_series().str.split("+").explode().drop_duplicates().to_list()
tf
get_ipython().run_line_magic('page', '')
tc.pfam.drop_duplicates().to_list()
tc = vndf.query('nei_c in [1,6,11]')
tc.pfam = tc.pfam.str.split("+")
tc = tc.explode('pfam')
tc.pfam.drop_duplicates().to_list()
tf
tc.query('pfam not in @tf').head()
tc.query('pfam not in @tf').pfam.value_counts()
tc.query('pfam not in @tf').pfam.value_counts().head(20)
tc.query('pfam not in @tf').pfam.value_counts().head(25)
tc.query('pfam not in @tf').pfam.value_counts().reset_index().head(25)
tc.query('pfam not in @tf').pfam.value_counts().reset_index().query('index.str.contains("Phage|Gp|Caudo|Baseplate")')
tc.query('pfam not in @tf').pfam.value_counts().reset_index().head(25)
tc.query('pfam not in @tf').pfam.value_counts().reset_index().query('index.str.contains("Phage|Gp|Caudo|Baseplate")').head(20)
tc.query('pfam not in @tf and nei_c == 1').pfam.value_counts().reset_index().query('index.str.contains("Phage|Gp|Caudo|Baseplate")').head(20)
tc.query('pfam not in @tf').groupby('nei_c').pfam.value_counts().reset_index().query('index.str.contains("Phage|Gp|Caudo|Baseplate")').head(20)
tc.query('pfam not in @tf').groupby('nei_c').pfam.value_counts()
get_ipython().run_line_magic('page', '')
tc.query('pfam not in @tf').groupby('nei_c').pfam.value_counts().query('pfam.str.contains("Phage|Gp|Caudo|Baseplate")')
tc.query('pfam not in @tf').groupby('nei_c').pfam.value_counts()
tc.query('pfam not in @tf').groupby('nei_c').pfam.value_counts().reset_index().head()
tc.query('pfam not in @tf').groupby('nei_c').pfam.value_counts().to_frame().head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0)
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int)
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int)
get_ipython().run_line_magic('page', '')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11])
get_ipython().run_line_magic('page', '')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index().head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index().query('pfam.str.contains("Phage|Caudo|Gp|Baseplate")')
get_ipython().run_line_magic('page', '')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index().query('not pfam.str.contains("Phage|Caudo|Gp|Baseplate")')
get_ipython().run_line_magic('page', '')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index().query('not pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index().query('pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")')
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', '')
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().query('pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")')
tc.query('pfam not in @tf').pfam.value_counts().reset_index().query('pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")').head(20)
tc.query('pfam not in @tf').pfam.value_counts().reset_index().head()
tc.query('pfam not in @tf').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().pivot(index='pfam', columns='nei_c', values='n').fillna(0).astype(int).sort_values([1,6,11]).reset_index().query('pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")')
tc.query('pfam not in @tf').pfam.value_counts().head()
tc.query('pfam not in @tf').pfam.value_counts().head(20)
tc.query('pfam not in @tf').pfam.value_counts().head(30)
tc.query('pfam not in @tf').).query('pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().head(30)
tc.query('pfam not in @tf').query('pfam.str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().head(30)
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().head(30)
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts()
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index()
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().head()
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 1000')
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 500')
", ".join(tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 1000')['index'])
tc2 = vndf.query('nei_c not in [1,6,11]')
", ".join(tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 1000')['index'])
", ".join(tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 3900')['index'])
tf2 = tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 3900')['index'].to_list()
tc2.pfam = tc2.pfam.fillna("").str.split("+")
tc2 = tc2.explode('pfam')
tc2.query('pfam not in @tf2').pfam.value_counts().reset_index()
get_ipython().run_line_magic('page', '')
tc2.query('pfam in @tf2').pfam.value_counts().reset_index()
tc2.query('pfam in @tf2').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().head(20)
tc2.query('pfam in @tf2').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().nei_c.nunique()
tc2.query('pfam in @tf2').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().nei_c.value_counts()
tc2[tc2.nei_c.isin([30,36,24])].block_id.nunique()
tc2.block_id.nunique()
tc2[tc2.nei_c.isin([30,36,24])].block_id.nunique() / tc2.block_id.nunique()
tc2[tc2.nei_c.isin([30,36,24])].block_id.nunique() / tc2.block_id.nunique() * 100
3 / 46
3 / 46 * 100
tc2[tc2.nei_c.isin([30,36,24])].compact()
from rotifer.genome.data import NeighborhoodDF
NeighborhoodDF(tc2[tc2.nei_c.isin([30,36,24])]).compact()
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', '')
final.head()
final.nei_c.value_counts()
tc2.query('pfam in @tf2').groupby('nei_c').agg(n=('pfam','value_counts')).reset_index().nei_c.value_counts()
final.nei_c.value_counts().sort_index()
get_ipython().run_line_magic('page', 'final')
", ".join(tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 3900')['index'])
len(tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 3900')['index'])
tc.query('pfam not in @tf').query('pfam.fillna("").str.contains("Phage|Caudo|Gp|Baseplate|Tail")').pfam.value_counts().reset_index().query('pfam > 3900')['index'].tolist()
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('pwd', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('pwd', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('history', '')
get_ipython().run_line_magic('logstate', '')
get_ipython().run_line_magic('pwd', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('logstart', 'source1.py')
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
get_ipython().run_line_magic('pwd', '')
get_ipython().run_line_magic('who', '')
vndf.shape
vndf.columns
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv", low_memory=False)
phagemodels = """Phage_base_V	GPW_gp25	Phage_GPD	Phage_spike	Phage_T4_gp19	Phage_tube	Mu-like_gpT	Phage_sheath_1	Phage_sheath_1C	Phage_tail_S	Phage_tail_X	Phage_pRha	gp37_C	gpW	Phage_fiber	Phage_fiber_2	P2_Phage_GpR	PhageMin_Tail	Phage_ASH	Phage_CP76	Phage_GPL	Phage_P2_GpU	Phage_T4_gp36	Phage_GPO	Phage_P2_GpE	Phage_TAC_10	Phage_TAC_7	Phage_AlpA	Phage-MuB_C	Phage_Cox	Phage_CI_C	Phage_CI_repr	Phage_holin_2_3	Phage_holin_3_1	Phage_holin_3_2	Phage_holin_3_6	Phage_int_SAM_1	Phage_int_SAM_2	Phage_int_SAM_3	Phage_int_SAM_4	Phage_integrase	Phage_lysis	Phage_lysozyme	Phage_term_smal	Phage_attach	Phage_cap_E	Phage_gp49_66	Phage_GPA	Phage_cap_P2	Phage_portal	Phage_portal_2	Phage_connector""".split("\t")
phagemodels
get_ipython().run_line_magic('pwd', '')
get_ipython().run_line_magic('ls', '')
pd.Series(phagemodels).to_csv("phagemodels.tsv")
pd.Series(phagemodels).to_csv("phagemodels.tsv", index=False)
pd.Series(phagemodels).to_csv("phagemodels.tsv", index=False, header=None)
vndf.pfam = vndf.pfam.fillna("").str.split("+")
vndf = vndf.explode('pfam')
vndf.shape
phagedf = vndf.query('pfam in @phagemodels')
phagedf.shape
phagedf = phagedf.drop_duplicates(['block_id','pfam'])
phagedist = phagedf.pivot_table(index='nei_c', columns='pfam', values='block_id', aggfunc='nunique', fill_value=0)
get_ipython().run_line_magic('page', 'phagedist')
get_ipython().run_line_magic('history', '')
get_ipython().run_line_magic('history', '-n')
phagedist = phagedf.pivot_table(index='nei_c', columns='pfam', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
get_ipython().run_line_magic('page', 'phagedist')
get_ipython().run_line_magic('page', 'phagedist')
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv", low_memory=False)
vndf.pfam = vndf.pfam.fillna("").str.split("+")
vndf = vndf.explode('pfam')
phagedf = vndf.query('pfam in @phagemodels')
phagedf = phagedf.drop_duplicates(['block_id','pfam'])
phagedist = phagedf.pivot_table(index='nei_c', columns='pfam', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
get_ipython().run_line_magic('page', 'phagedist')
vndfstats = vdfn.groupby('nei_c').agg(genomes=('assembly','nunique'), loci=('block_id','nunique'))
vndfstats = vndf.groupby('nei_c').agg(genomes=('assembly','nunique'), loci=('block_id','nunique'))
vndfstats
vndf.join(phagedist, how='left')
vndfstats.join(phagedist, how='left')
get_ipython().run_line_magic('page', '')
vndfstats.join(phagedist, how='left').fillna(0).astype(int)
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('history', '-n')
get_ipython().run_line_magic('rep', '198-203 206 211')
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv", low_memory=False)
vndf.pfam = vndf.pfam.fillna("").str.split("+")
vndf = vndf.explode('pfam')
phagedf = vndf.query('pfam in @phagemodels')
phagedf = phagedf.drop_duplicates(['block_id','pfam'])
phagedist = phagedf.pivot_table(index='nei_c', columns='pfam', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
vndfstats = vndf.groupby('nei_c').agg(genomes=('assembly','nunique'), loci=('block_id','nunique'))
vndfmodelstats = vndfstats.join(phagedist, how='left').fillna(0).astype(int)
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('save', 'modelstats.py 215')
get_ipython().system('vim modelstats.py')
pd.read_csv("phagemodes.tsv", header=None).iloc[0].tolist()
pd.read_csv("phagemodels.tsv", header=None).iloc[0].tolist()
pd.read_csv("phagemodels.tsv", header=None)[0].tolist()
len(pd.read_csv("phagemodels.tsv", header=None)[0].tolist())
len(phagemodels)
get_ipython().system('nvim modelstats.py')
get_ipython().run_line_magic('cat', 'modelstats.py')
tf
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('less', 'rename_model_name.yaml')
get_ipython().run_line_magic('less', 'model2function.yaml')
get_ipython().run_line_magic('less', 't6ss.acc')
get_ipython().run_line_magic('less', 'domains.tsv')
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
vndf.head(30)
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('who', '')
t6ss = pd.read_excel("t6ss.xlsx","all")
get_ipython().run_line_magic('page', 't6ss')
get_ipython().run_line_magic('page', 't6ss')
get_ipython().run_line_magic('pinfo2', 'pd.DataFrame.melt')
vndf.filter(['block_id','rocha','pfam','aravind']).melt(id_vars='block_id', value_vars=['rocha','pfam','aravind']).head()
vndf.filter(['block_id','rocha','pfam','aravind']).melt(id_vars='block_id', value_vars=['rocha','pfam','aravind']).sample(30)
vndf.filter(['nei_c','assembly','block_id','rocha','pfam','aravind']).melt(id_vars=['assembly','nei_c','block_id'], value_vars=['rocha','pfam','aravind']).sample(30)
x = vndf.filter(['nei_c','assembly','block_id','rocha','pfam','aravind']).melt(id_vars=['assembly','nei_c','block_id'], value_vars=['rocha','pfam','aravind'])
x.head()
x = vndf.filter(['nei_c','assembly','block_id','rocha','pfam','aravind']).melt(id_vars=['assembly','nei_c','block_id'], value_vars=['rocha','pfam','aravind'], value_name='arch')
x.arch = x.arch.str.split("+")
x = x.explode('arch')
t6s.head()
t6ss.head()
t6ss.set_index('model')['replace'].to_dict()
x.arch.replace(t6ss.set_index('model')['replace'].to_dict()).value_counts().head(50)
get_ipython().run_line_magic('page', '')
x.arch.replace(t6ss.set_index('model')['replace'].to_dict(), inplace=True)
x.head()
x = x.drop_duplicates(['block_id','arch'])
phagemodels
t6ss['replace']
get_ipython().run_line_magic('page', 't6ss')
vndf.columns
vndf.query('cdd.fillna("").str.contains("MIX", case=False, regexp=True)')
vndf.query('cdd.fillna("").str.contains("MIX", case=False, regex=True)')
get_ipython().run_line_magic('page', '')
t6ssmodels = "HCP VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssH TssJ TssL TssM DUF4123 DcrB MIX".split()
t6ssmodels
t6ss.query('replace not in @t6ssmodels')
t6ssmodels = "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssH TssJ TssL TssM DUF4123 DcrB MIX".split()
t6ss.query('replace not in @t6ssmodels')
vndf.query('cdd.fillna("").str.contains("PAAR", case=False, regex=True)').arch.unique()
vndf.query('aravind.fillna("").str.contains("PAAR", case=False, regex=True)').arch.unique()
vndf.query('aravind.fillna("").str.contains("PAAR", case=False, regex=True)').aravind.unique()
get_ipython().run_line_magic('page', 't6ss')
vndf.columns
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
get_ipython().run_line_magic('who', '')
x.columns
x.arch.where(lambda x: x.fillna("").str.contains("PAAR", case=False, regex=True)).dropna().drop_duplicates()
t6ssmodels
t6ss.query('replace not in @t6ssmodels')
vndf.columns
x = vndf.filter(['nei_c','assembly','block_id','cdd','rocha','pfam','aravind']).melt(id_vars=['assembly','nei_c','block_id'], value_vars=['cdd','rocha','pfam','aravind'], value_name='arch')
x.arch = x.arch.str.split("+")
x = x.explode('arch')
x.arch.replace(t6ss.set_index('model')['replace'].to_dict(), inplace=True)
x = x.drop_duplicates(['block_id','arch'])
x.shape
phagemodels
t6ss['replace']
t6ss['replace'].tolist() + phagemodels
allmodels = t6ss['replace'].tolist() + phagemodels
x = x.query('arch in @allmodels')
modeldist = x.pivot_table(index='nei_c', columns='arch', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
get_ipython().run_line_magic('page', 'modeldist')
vndfstats.join(modeldist, how='left').fillna(0).astype(int)
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('ls', '')
get_ipython().run_line_magic('less', 'jaccard_type_classification.yaml')
get_ipython().run_line_magic('less', 'jaccard_group_classification.yaml')
get_ipython().run_line_magic('less', 'jaccard_type_classification.yaml')
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('less', 'jaccard_group_classification.yaml')
get_ipython().run_line_magic('less', 'jaccard_type_classification.yaml')
stats = vndfstats.join(modeldist, how='left').fillna(0).astype(int).reset_index()
get_ipython().run_line_magic('page', 'stats')
get_ipython().run_line_magic('page', 'stats')
import pyyaml
import yaml
get_ipython().run_line_magic('who', '')
type_dict
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('less', '../')
get_ipython().run_line_magic('less', '../sources/working_dfs.py')
j1
j2
stats.insert(0, 'revised', stats.nei_c.map(j1).tolist())
get_ipython().run_line_magic('page', 'stats')
stats.drop('revised', axis=0)
stats.drop('revised', axis=1)
get_ipython().run_line_magic('page', '')
stats.drop('revised', axis=1, inplace=True)
stats.insert(3, 'revised', stats.nei_c.map(j1).tolist())
get_ipython().run_line_magic('page', 'stats')
stats.drop('revised', axis=1, inplace=True)
stats.insert(1, 'revised', stats.nei_c.map(j1).tolist())
get_ipython().run_line_magic('page', 'stats')
stats.insert(2, 'final', stats.revised.map(j2).tolist())
get_ipython().run_line_magic('page', 'stats')
j2
get_ipython().run_line_magic('page', 'stats')
j1
get_ipython().run_line_magic('page', 'stats')
stats.loc[stats.nei_c.isin([24,30,36]),]
get_ipython().run_line_magic('page', '')
stats.loc[stats.nei_c.isin([24,30,36]),'final']
stats.loc[stats.nei_c.isin([24,30,36]),'final'] = 'Phage / Tailocin'
stats.loc[stats.final == 'Tailocin',]
get_ipython().run_line_magic('page', '')
stats.loc[stats.nei_c.isin([1,6,11]),'final'] = 'Phage / Tailocin'
get_ipython().run_line_magic('page', 'stats')
stats.final.replace("-","Orphan")
get_ipython().run_line_magic('page', '')
stats.final.replace("-","Orphan",inplace=True)
get_ipython().run_line_magic('page', 'stats')
stats.sort_values(['final','genomes'], ascending=[True,False])
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', '')
stats.sort_values(['final','genomes'], ascending=[True,True])
get_ipython().run_line_magic('page', '')
stats.sort_values(['final','genomes'], ascending=[False,True])
get_ipython().run_line_magic('page', '')
stats.sort_values(['final','genomes'], ascending=[False,False])
get_ipython().run_line_magic('page', '')
t6ss.query('replace not in @t6ssmodels')
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', 'stats')
t6ss.query('replace not in @t6ssmodels')['replace'].tolist()
t6ssmodels
get_ipython().run_line_magic('page', 'stats')
stats.sort_values(['final','genomes'], ascending=[False,False], inplace=True)
get_ipython().run_line_magic('page', 'stats')
x[x.arch == "VipA"]
x[x.arch == "VipA"].block_id
x[x.arch == "VipA"]
vndf[vndf.block_id.isin(x[x.arch == "VipA"].block_id)]
vndf[vndf.rocha.fillna("").str.contains("Vip[BA]", regex=True)].head(100)
get_ipython().run_line_magic('page', '')
import subprocess
from io import StringIO
from rotifer.devel.beta import sequence as rdbs
TssC = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.hmm','TssC'], capture_output=True).stdout.decode()),"stockholm")
TssC.view()
TssC
TssC.df
subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.hmm','TssC'], capture_output=True).stdout.decode()
subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','TssC'], capture_output=True).stdout.decode()
TssC = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','TssC'], capture_output=True).stdout.decode()),"stockholm")
TssC.view()
TssC.hhsearch(databases=['pfam'])
TssB = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','TssB'], capture_output=True).stdout.decode()),"stockholm")
TssB.view()
TssB.df
del(TssB)
get_ipython().run_line_magic('history', '-n')
get_ipython().run_line_magic('ls', '-lrth')
TssC.hhsearch(databases=['pfam'])
vndf[vndf.rocha.fillna("").str.contains("T6SSii_iglB", regex=True)].pfam.value_counts()
get_ipython().run_line_magic('history', '-n')
modeldist = x.pivot_table(index='nei_c', columns='arch', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('load', 'modelstats.py')
# %load modelstats.py
#!/usr/bin/python3

t6ss = pd.read_excel("t6ss.xlsx","all")
phagemodels = pd.read_csv("phagemodels.tsv", header=None)[0].tolist()
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv", low_memory=False)
allmodels = t6ss['replace'].tolist() + phagemodels

vndf = vndf.filter(['nei_c','assembly','block_id','cdd','rocha','pfam','aravind']).melt(id_vars=['assembly','nei_c','block_id'],value_vars=['cdd','rocha','pfam','aravind'],value_name='arch')
phagedf.arch = phagedf.arch.fillna("").str.split("+")
phagedf = phagedf.explode('arch')
phagedf = phagedf.query('arch in @allmodels')
phagedf = phagedf.drop_duplicates(['block_id','pfam'])
modeldist = phagedf.pivot_table(index='nei_c', columns='pfam', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
vndfstats = vndf.groupby('nei_c').agg(genomes=('assembly','nunique'), loci=('block_id','nunique'))
stats = vndfstats.join(modeldist, how='left').fillna(0).astype(int)
stats.sort_values(['final','genomes'], ascending=[False,False], inplace=True)
get_ipython().run_line_magic('load', 'modelstats.py')
# %load modelstats.py
#!/usr/bin/python3

t6ss = pd.read_excel("t6ss.xlsx","all")
phagemodels = pd.read_csv("phagemodels.tsv", header=None)[0].tolist()
vndf = pd.read_table("10k_vizinho_novo_df_jaccard.tsv", low_memory=False)
allmodels = t6ss['replace'].tolist() + phagemodels

phagedf = vndf.filter(['nei_c','assembly','block_id','cdd','rocha','pfam','aravind'])
pahgedf = phagedf.melt(id_vars=['assembly','nei_c','block_id'], value_vars=['cdd','rocha','pfam','aravind'], value_name='arch')
phagedf.arch = phagedf.arch.fillna("").str.split("+")
phagedf = phagedf.explode('arch')
phagedf = phagedf.query('arch in @allmodels')
phagedf = phagedf.drop_duplicates(['block_id','pfam'])
modeldist = phagedf.pivot_table(index='nei_c', columns='pfam', values='block_id', aggfunc='nunique', fill_value=0, dropna=False)
vndfstats = vndf.groupby('nei_c').agg(genomes=('assembly','nunique'), loci=('block_id','nunique'))
stats = vndfstats.join(modeldist, how='left').fillna(0).astype(int)
stats.sort_values(['final','genomes'], ascending=[False,False], inplace=True)
phagedf.head()
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
stats.insert(1, 'revised', stats.nei_c.map(j1).tolist())
stats.insert(2, 'final', stats.revised.map(j2).tolist())
stats.sort_values(['final','genomes'], ascending=[False,False], inplace=True)
stats.columns
stats
get_ipython().run_line_magic('page', '')
stats.reset_index(inplace=True)
stats.insert(1, 'revised', stats.nei_c.map(j1).tolist())
stats.insert(2, 'final', stats.revised.map(j2).tolist())
stats.sort_values(['final','genomes'], ascending=[False,False], inplace=True)
get_ipython().run_line_magic('page', 'stats')
stats.final.replace("-","Orphan",inplace=True)
stats.sort_values(['final','genomes'], ascending=[False,False], inplace=True)
get_ipython().run_line_magic('page', 'stats')
phagemodels
get_ipython().run_line_magic('page', 'stats')
stats.dtypes
stats.set_index('nei_c').select_dtypes(np.int64).columns
stats.set_index('nei_c').drop(['genomes','loci']).columns
stats.set_index('nei_c').drop(['genomes','loci'], axis=1).columns
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).columns
stats.loci
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1) / stats.loci
get_ipython().run_line_magic('page', '')
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).values
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).values / stats.loci
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1) 
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).div(stats.loci)
stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).div(stats.loci, axis=0)
get_ipython().run_line_magic('page', '')
(stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).div(stats.loci, axis=0) * 100)
get_ipython().run_line_magic('page', '')
percent = (stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).div(stats.loci, axis=0) * 100).reset_index()
get_ipython().run_line_magic('page', 'percent')
percent.locpercent.nei_c == 6,'Phage_spike']
percent.loc[percent.nei_c == 6,'Phage_spike']
percent.loc[percent.nei_c == 11,'Phage_spike']
stats.loc[percent.nei_c == 11,'Phage_spike']
stats.loc[stats.nei_c == 11,'Phage_spike']
stats.loc[stats.nei_c == 11,['loci','Phage_spike']]
3668/3766
vndf.assembly.str[0:2].head()
vndf.assembly.str[0:2].value_counts()
percent = stats.copy()
percent.loc[:,stats.drop(['nei_c','genomes','loci','revised','final'], axis=1).columns.tolist()] = (stats.set_index('nei_c').drop(['genomes','loci','revised','final'], axis=1).div(stats.loci, axis=0) * 100).reset_index()
get_ipython().run_line_magic('page', 'percent')
percent.loc[percent.nei_c == 11,'Phage_spike']
percent.loc[percent.nei_c == 6,'Phage_spike']
stats.loc[stats.nei_c == 11,'Phage_spike']
percent.loc[percent.nei_c == 11,'Phage_spike']
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('ls', '../sources/')
get_ipython().run_line_magic('ls', '../sources/Figure\\ 1/')
get_ipython().run_line_magic('ls', '../sources/Figure\\ 1/*')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('page', 'percent')
percent.loc[percent.nei_c == 11,'Phage_spike']
stats.loc[stats.nei_c == 11,'Phage_spike']
percent.loc[percent.nei_c == 11,['loci','Phage_spike']]
vndf.assembly.str[0:2].value_counts()
get_ipython().run_line_magic('page', 'stats')
"Phage_base_V	GPW_gp25	Phage_GPD".split("\t")
stats.columns.isin("Phage_base_V	GPW_gp25	Phage_GPD".split("\t")).sum()
stats.columns
allmodels
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', '')
stats.columns
allmodels
get_ipython().run_line_magic('page', '')
phagemodels
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('page', 'percent')
percent.loc[percent.nei_c == 21,['loci','TssA'])
percent.loc[percent.nei_c == 21,['loci','TssA']]
pd.Series("AEFGK")
pd.Series(list("AEFGK"))
"Tss" + pd.Series(list("AEFGK"))
percent.loc[percent.nei_c == 21,['loci',"Tss" + pd.Series(list("AEFGK"))]]
percent.loc[percent.nei_c == 21,['loci',"Tss" + pd.Series(list("AEFGK")).tolist()]]
percent.loc[percent.nei_c == 21,['loci']+"Tss" + pd.Series(list("AEFGK")).tolist()]
percent.loc[percent.nei_c == 21,['loci']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
percent.loc[percent.nei_c == 21,['genomes','loci']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
percent.loc[percent.nei_c == 21,['genomes','loci','VgrG']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
percent.loc[percent.nei_c == 21,['nei_c','genomes','loci','VgrG']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
percent.loc[percent.nei_c == 21,['nei_c','genomes','loci','VgrG','Phage_base_V']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
t6ssdict
percent.loc[percent.nei_c == 21,['nei_c','genomes','loci','VgrG','Phage_base_V']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
df.arch2 = df.arch.replace(t6ssdict)
not6df = df.query('arch2 not in @t6ssmodels')
df['arch2'] = df.arch.replace(t6ssdict)
not6df = df.query('arch2 not in @t6ssmodels')
not6df.arch2.value_counts()
not6df.arch2.value_counts().head()
not6df.arch2.value_counts().head(30)
not6df.groupby('nei_c').arch2.value_counts().head(30)
not6df.groupby('nei_c').arch2.value_counts().to_frame().head(30)
not6df.groupby('nei_c').arch2.value_counts().to_frame().query('arch2 > 1000').head(30)
not6df.groupby('nei_c').arch2.value_counts().reset_index().query('arch2 > 1000 and nei_c == 6').head(30)
not6df.groupby('nei_c').arch2.value_counts().reset_index().head()
not6df.groupby('nei_c').arch2.value_counts().rename('n').reset_index().head()
not6df.groupby('nei_c').arch2.value_counts().rename('n').reset_index().query('arch2 > 1000 and nei_c == 6')
not6df.groupby('nei_c').arch2.value_counts().rename('n').reset_index().query('n > 1000 and nei_c == 6')
not6df.groupby('nei_c').arch2.value_counts().rename('n').reset_index().query('nei_c == 6')
get_ipython().run_line_magic('page', '')
not6df.groupby('nei_c').arch2.value_counts().rename('n').reset_index().query('nei_c == 21')
get_ipython().run_line_magic('page', '')
t6ssdf.groupby('nei_c').arch2.value_counts().rename('n').reset_index().query('nei_c == 21')
t6ssdf.groupby('nei_c').arch.value_counts().rename('n').reset_index().query('nei_c == 21')
phagedf.groupby('nei_c').arch.value_counts().rename('n').reset_index().query('nei_c == 21')
t6ss.query('replace == "VgrG')
t6ss.query('replace == "VgrG"')
df10[df10.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | df10.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | df10.aravind.fillna("").str.contains("VgrG")].pid.nunique()
df10[df10.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | df10.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | df10.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique'))
df10.columns
vndf[vndf.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | vndf.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | vndf.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique'))
vndf.block_id.nunique()
vndf[vndf.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | vndf.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | vndf.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique')) / vndf.block_id.nunique()
vndf[vndf.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | vndf.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | vndf.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique')).div(vndf.groupby('nei_c').block_id.nunique())
vndf.groupby('nei_c').block_id.nunique()
vndf[vndf.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | vndf.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | vndf.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique').nb).div(vndf.groupby('nei_c').block_id.nunique())
vndf[vndf.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | vndf.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | vndf.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique'))[['nb']].div(vndf.groupby('nei_c').block_id.nunique())
vndf.groupby('nei_c').block_id.nunique()
vndf[vndf.pfam.fillna("").str.contains("Phage_base_V|T6SS_Vgr") | vndf.rocha.fillna("").str.contains("T6SSi_tssI|T6SSiii_tssI") | vndf.aravind.fillna("").str.contains("VgrG")].groupby('nei_c').agg(np=('pid','nunique'), nb=('block_id','nunique'), na=('assembly','nunique'))
vndf.groupby('nei_c').block_id.nunique().loc[21]
1923/5423
get_ipython().run_line_magic('page', 'percent')
DUF4123 = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','DUF4123'], capture_output=True).stdout.decode()),"stockholm")
DUF4123.hhsearch(databases=['pfam'])
get_ipython().run_line_magic('page', 'percent')
t6ss.query('replace == "VgrG"')
get_ipython().run_line_magic('page', 'stats')
get_ipython().run_line_magic('page', 'percent')
TagF_N = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','TagF_N'], capture_output=True).stdout.decode()),"stockholm")
TagF_N.hhsearch()
get_ipython().run_line_magic('page', 'not6df')
not6df.groupby('nei_c').arch2.value_counts().rename('n').reset_index().query('nei_c == 21')
get_ipython().run_line_magic('page', '')
vndf.query('nei_c == 21').pfam.value_counts()
get_ipython().run_line_magic('page', '')
df.query('nei_c == 21 and arch in @allmodels').arch.value_counts()
df.query('nei_c == 21').arch.value_counts()
get_ipython().run_line_magic('page', '')
DUF2345 = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','DUF2345'], capture_output=True).stdout.decode()),"stockholm")
DUF2345.hhsearch(databases=['pfam'])
get_ipython().run_line_magic('who', '')
del(pahgedf)
df.query('nei_c == 21 and arch.fillna("").str.conatins("DUF")').arch.value_counts()
df.query('nei_c == 21 and arch.fillna("").str.contains("DUF")').arch.value_counts()
DUF4203 = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','DUF4203'], capture_output=True).stdout.decode()),"stockholm")
DUF4203.hhsearch(databases=['pfam'])
DUF4203.df
df.query('nei_c == 21 and arch.fillna("").str.contains("DUF")').arch.value_counts()
DUF2195 = rdbs.sequence(StringIO(subprocess.run(['esl-afetch','/databases/pfam/Pfam-A.seed','DUF2195'], capture_output=True).stdout.decode()),"stockholm")
DUF2195.hhsearch(databases=['pfam'])
df.query('nei_c == 21 and arch.fillna("").str.contains("DUF")').arch.value_counts()
df.columns
vndf.columns
df.query('nei_c == 21 and t6ss').arch.value_counts()
vndf.query('nei_c == 21 and t6ss').arch.value_counts()
vndf.query('nei_c == 21 and t6ss').pfam.value_counts()
get_ipython().run_line_magic('page', '')
t6ssmodels
get_ipython().run_line_magic('who', '')
percent[['genomes','revised','final'] + "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssH TssJ TssL TssM DUF4123 DcrB MIX".split()]
percent[['genomes','revised','final'] + "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssJ TssL TssM DUF4123 DcrB".split()]
get_ipython().run_line_magic('page', '')
percent.columns
percent[['nei_c','genomes','revised','final'] + "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssJ TssL TssM DUF4123 DcrB".split()]
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', 'stats')
stats[['nei_c','genomes','revised','final'] + "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssJ TssL TssM DUF4123 DcrB".split()]
get_ipython().run_line_magic('page', '')
percent[['nei_c','genomes','revised','final'] + "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssJ TssL TssM DUF4123 DcrB".split()]
get_ipython().run_line_magic('page', '')
stats[['nei_c','genomes','revised','final'] + "Hcp VgrG PAAR TssA TssE TssF TssG TssK TssB TssC TssJ TssL TssM DUF4123 DcrB".split()]
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('run', 'modelstats.py')
percent.loc[percent.nei_c == 21,['nei_c','genomes','loci','VgrG','Phage_base_V']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
stats.loc[percent.nei_c == 21,['nei_c','genomes','loci','VgrG','Phage_base_V']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
stats.loc[stats.nei_c == 21,['nei_c','genomes','loci','VgrG','Phage_base_V']+ ("Tss" + pd.Series(list("AEFGK"))).tolist()]
t6ss.query('replace == "VgrG"')
vndf.query('nei_c == 21 and pfam.fillna("").str.contains("Phage_GPD") and not and pfam.fillna("").str.contains("Phage_base_V")').pfam.value_counts()
vndf.query('nei_c == 21 and pfam.fillna("").str.contains("Phage_GPD") and not pfam.fillna("").str.contains("Phage_base_V")').pfam.value_counts()
vndf.query('nei_c == 21 and pfam.fillna("").str.contains("Phage_GPD") and not pfam.fillna("").str.contains("Phage_base_V")').aravind.value_counts()
vndf.query('nei_c == 21 and pfam.fillna("").str.contains("Phage_GPD") and not pfam.fillna("").str.contains("Phage_base_V")').rocha.value_counts()
vndf.query('nei_c == 21 and pfam.fillna("").str.contains("Phage_base_V") and not pfam.fillna("").str.contains("Phage_GPD")').pfam.value_counts()
vndf.query('pfam.fillna("").str.contains("Phage_base_V") and not pfam.fillna("").str.contains("Phage_GPD")').pfam.value_counts()
vndf.query('pfam.fillna("").str.contains("Phage_base_V") and not pfam.fillna("").str.contains("Phage_GPD")').aravind.value_counts()
vndf.query('pfam.fillna("").str.contains("Phage_base_V") and not pfam.fillna("").str.contains("Phage_GPD")').pfam.value_counts().sum()
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('page', 'percent')
percent.columns
phagemodels
len(phagemodels)
t6ssmodels
t6ssdict
t6ssmarkers = "TssA TssE TssF TssG TssK TssB TssC TssH TssJ TssL TssM".split()
len(t6ssmarkers)
percent[t6ssmarkers]
t6ssmarkers = "TssA TssE TssF TssG TssK TssB TssC TssJ TssL TssM".split()
percent[t6ssmarkers]
percent.set_index('nei_c').loc[:,t6ssmarkers]
percent.set_index('nei_c').loc[:,t6ssmarkers].sum(axis=0)
percent.set_index('nei_c').loc[:,t6ssmarkers].sum(axis=1)
percent.set_index('nei_c').loc[:,t6ssmarkers] > 0.5
(percent.set_index('nei_c').loc[:,t6ssmarkers] > 0.5).sum(axis=1)
percent.columns
percent.index
get_ipython().run_line_magic('page', 'percent')
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ssmarkers] > 0.5).sum(axis=1))
get_ipython().run_line_magic('page', 'percent')
len(t6ssmarkers)
get_ipython().run_line_magic('page', 'percent')
percent.set_index('nei_c').loc[:,t6ssmarkers]
get_ipython().run_line_magic('page', 'percent')
percent.set_index('nei_c').loc[:,t6ssmarkers]
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ssmarkers] > 50).sum(axis=1))
percent.drop('T6SS',axis=1,inplace=True)
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ssmarkers] > 50).sum(axis=1))
get_ipython().run_line_magic('page', 'percent')
percent.drop('T6SS',axis=1,inplace=True)
get_ipython().run_line_magic('page', 'percent')
percent.set_index('nei_c').loc[:,t6ssmarkers] > 50
(percent.set_index('nei_c').loc[:,t6ssmarkers] > 50).sum(axis=1)
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ssmarkers] > 50).sum(axis=1).to_list())
get_ipython().run_line_magic('page', 'percent')
t6ssmarkers
t6ss
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', '')
t6ss.query('core == 1').core.drop_duplicates()
get_ipython().run_line_magic('page', '')
get_ipython().run_line_magic('page', 't6ss')
t6ss.query('core == 1')['replace'].drop_duplicates()
t6ss.query('core == 1')['replace'].drop_duplicates().tolist()
percent.drop('T6SS',axis=1,inplace=True)
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ss.query('core == 1')['replace'].drop_duplicates().tolist()] > 50).sum(axis=1).to_list())
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('page', 'percent')
percent.drop('T6SS',axis=1,inplace=True)
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ss.query('core == 1')['replace'].drop_duplicates().tolist()] >= 50).sum(axis=1).to_list())
get_ipython().run_line_magic('page', 'percent')
percent.drop('T6SS',axis=1,inplace=True)
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ss.query('core == 1 AND replace != "ClpV"')['replace'].drop_duplicates().tolist()] >= 50).sum(axis=1).to_list())
percent.insert(5,'T6SS',(percent.set_index('nei_c').loc[:,t6ss.query('core == 1 and replace != "ClpV"')['replace'].drop_duplicates().tolist()] >= 50).sum(axis=1).to_list())
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('page', 'percent')
t6ss.query('core == 1 and replace != "ClpV"')['replace'].drop_duplicates().tolist()
t6ss.query('core == 1 and replace != "ClpV"')['replace'].drop_duplicates().sort_values().tolist()
get_ipython().run_line_magic('ls', '/net/bkp/')
get_ipython().run_line_magic('ls', '/net/bkp/data/')
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/')
get_ipython().run_line_magic('who', '')
df10.columns
df10.cdd.value_counts()
get_ipython().run_line_magic('pwd', '')
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/')
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/fase1/')
\ls /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/')
get_ipython().system('\\ls /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/')
get_ipython().system('\\ls /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/ | cut -f 1 -d .')
get_ipython().system('\\ls /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/ | cut -f 1 -d . | sort -u')
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/')
get_ipython().system("grep -E 'NAME|ACC' /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd.hmm")
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/pfam/')
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/pfam/T6SS*')
get_ipython().run_line_magic('ls', '/net/bkp/data/backup/haldane/projects/salmonella/data/models/pfam/T*SS*')
get_ipython().system("grep -E 'NAME|ACC' /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd.hmm")
get_ipython().system('grep MIX /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/cddid_all.t6ss.tbl')
get_ipython().system('grep MIX /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/cddid_all.t6ss.tbl | less -S')
get_ipython().system('grep FIX /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/cddid_all.t6ss.tbl | less -S')
get_ipython().system("grep FIX /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/cddid_all.t6ss.tbl | column -t -s $'\\t' | less -S")
get_ipython().system("grep PAAR /net/bkp/data/backup/haldane/projects/salmonella/data/models/cdd/cddid_all.t6ss.tbl | column -t -s $'\\t' | less -S")
get_ipython().run_line_magic('who', '')
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('run', 'modelstats.py')
get_ipython().run_line_magic('page', 'percent')
get_ipython().run_line_magic('page', 'percent')
phagemodels
get_ipython().run_line_magic('page', '')
